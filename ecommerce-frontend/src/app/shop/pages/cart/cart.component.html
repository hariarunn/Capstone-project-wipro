<section class="max-w-7xl mx-auto px-4 py-8 animate-fade-in">
  <h1 class="text-2xl font-bold mb-4">Your Cart</h1>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Items -->
    <div class="lg:col-span-8 space-y-3">
      <div class="card-base p-4 flex items-center gap-4" *ngFor="let i of (items$ | async); trackBy: trackById">
        <div class="w-20 h-20 rounded-xl overflow-hidden border border-neutral-200 dark:border-neutral-800">
          <img [src]="i.imageUrl" [alt]="i.title" class="w-full h-full object-cover" loading="lazy" />
        </div>

        <div class="flex-1">
          <div class="font-medium leading-tight">{{ i.title }}</div>
          <div class="subtle">₹{{ i.price | number }} &middot; In stock: {{ i.stock }}</div>

          <div class="mt-3 flex items-center gap-2">
            <div class="qty">
              <button (click)="dec(i)" [disabled]="i.qty<=1">−</button>
              <input [value]="i.qty" type="number" min="1" [max]="i.stock"
                     (change)="onQtyChange(i, $event)" />
              <button (click)="inc(i)" [disabled]="i.qty>=i.stock">+</button>
            </div>
            <button class="btn-ghost" (click)="remove(i)">Remove</button>
          </div>
        </div>

        <div class="text-right w-24 font-semibold">
          ₹{{ (i.price * i.qty) | number }}
        </div>
      </div>

      <!-- Empty -->
      <div class="card-base p-8 text-center" *ngIf="!(items$ | async)?.length">
        <div class="text-xl font-semibold mb-1">Your cart is empty</div>
        <p class="subtle mb-4">Add products from the catalog to see them here.</p>
        <a routerLink="/catalog" class="btn-primary hover-pop">Browse products</a>
      </div>
    </div>

    <!-- Summary -->
    <aside class="lg:col-span-4">
      <div class="card-base p-4 sticky top-24">
        <h3 class="heading mb-3">Order Summary</h3>

        <div class="flex items-center gap-2 mb-3">
          <input class="input" placeholder="Coupon (DEAL10 / FREESHIP)" [(ngModel)]="code" (keydown.enter)="applyCoupon()" />
          <button class="btn-ghost" (click)="applyCoupon()">Apply</button>
        </div>

        <ng-container *ngIf="(totals$ | async) as t">
          <div class="row"><span>Subtotal</span><span>₹{{ t.subtotal | number }}</span></div>
          <div class="row"><span>Discount</span><span class="text-emerald-600">− ₹{{ t.discount | number }}</span></div>
          <div class="row"><span>Shipping</span><span>{{ t.shipping ? ('₹' + (t.shipping | number)) : 'Free' }}</span></div>
          <div class="row"><span>Tax (12%)</span><span>₹{{ t.tax | number }}</span></div>
          <div class="divider"></div>
          <div class="row total"><span>Total</span><span>₹{{ t.total | number }}</span></div>

          <button class="btn-primary w-full hover-pop mt-4"
                  [disabled]="!(items$ | async)?.length"
                  (click)="goCheckout()">
            Proceed to Checkout
          </button>

          <div class="subtle mt-2" *ngIf="t.coupon">Applied: <span class="chip">{{ t.coupon }}</span></div>
        </ng-container>
      </div>
    </aside>
  </div> 
</section>
